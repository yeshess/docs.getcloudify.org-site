machine:
  node:
    version: 4.4.7
  environment:
    s3_url: stage-docs.getcloudify.org/chen/
    region: eu-west-1

dependencies:
  post:
    - npm install -g git+https://git@github.com/gulpjs/gulp.git#4.0

deployment:
  aws:
    branch: next
    commands:
      - git clone https://github.com/ChenRoth/yoda.git
      - yoda/bin/yoda -d ~/${CIRCLE_PROJECT_REPONAME} --sources=core-sources.json build
      - . migrate-docs.sh
      - yoda/bin/yoda -d ~/${CIRCLE_PROJECT_REPONAME} --sources=core-sources.json build
      - rm -rf ~/${CIRCLE_PROJECT_REPONAME}/content
      - yoda/bin/yoda -d ~/${CIRCLE_PROJECT_REPONAME} --sources=plugin-sources.json build --clean=false
      - aws s3 sync ~/${CIRCLE_PROJECT_REPONAME}/build s3://${s3_url} --acl public-read --region ${region}
#bump2
